# Agent Routing Configuration
# Generated by setup.sh v3.3 - 2026-01-22
# Workflow: full-multiagent | Preset: balanced

version: "1.0"
workflow_type: "full-multiagent"
performance_preset: "balanced"

# Agent Definitions
agents:
  orchestrator:
    provider: "claude"
    model: "claude-opus-4-5-20251101"
    role: "Planning, code generation, skill interpretation"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
      - Task
      - TodoWrite

  analyst:
    provider: "gemini"
    model: "gemini-3-pro"
    role: "Large-scale analysis, research, code review"
    mcp_tool: "ask-gemini"
    enabled: true
    capabilities:
      - "1M+ token context"
      - "Deep code analysis"
      - "Architecture review"
      - "Research synthesis"

  executor:
    provider: "openai"
    model: "gpt-5.2-codex"
    role: "Command execution, builds, deployments"
    mcp_tool: "shell"
    enabled: true
    capabilities:
      - "Sandboxed execution"
      - "Long-running tasks"
      - "Docker/K8s operations"
      - "CI/CD pipelines"

# Task Routing Rules
routing:
  # Analysis tasks → Analyst (Gemini)
  analysis:
    patterns:
      - "분석"
      - "리뷰"
      - "코드 리뷰"
      - "아키텍처"
      - "전체.*분석"
      - "패턴.*분석"
    agent: "analyst"
    fallback: "orchestrator"

  # Execution tasks → Executor (Codex)
  execution:
    patterns:
      - "실행"
      - "빌드"
      - "테스트"
      - "배포"
      - "docker"
      - "npm"
      - "git"
    agent: "executor"
    fallback: "orchestrator"

  # Planning/coding → Orchestrator (Claude)
  orchestration:
    patterns:
      - "계획"
      - "설계"
      - "구현"
      - "작성"
      - "생성"
      - "수정"
    agent: "orchestrator"

# Workflow Templates
templates:
  api-development:
    name: "API Development"
    steps:
      - agent: orchestrator
        action: "Load api-design skill, create spec"
      - agent: analyst
        action: "Analyze existing API patterns"
        condition: "if codebase > 10 files"
      - agent: orchestrator
        action: "Implement API code"
      - agent: executor
        action: "Run tests and build"
      - agent: orchestrator
        action: "Generate documentation"

  code-review:
    name: "Code Review"
    steps:
      - agent: analyst
        action: "Deep code analysis with gemini"
      - agent: orchestrator
        action: "Summarize findings, suggest improvements"

  deployment:
    name: "Deployment Pipeline"
    steps:
      - agent: orchestrator
        action: "Prepare deployment config"
      - agent: executor
        action: "Run build and tests"
      - agent: executor
        action: "Deploy to environment"
      - agent: orchestrator
        action: "Verify deployment status"

# Performance Tweaks
performance_tweaks:
  # Prompt Repetition (ralph-loop) - Google Research 2025
  # Improves accuracy for lightweight models by 67% on benchmarks
  prompt_repetition:
    enabled: true
    default_repetitions: 2
    position_repetitions: 3  # For index/position tasks
    max_context_ratio: 0.8
    # Auto-apply on these lightweight models
    auto_apply_on_models:
      - "claude-haiku"
      - "claude-3-haiku"
      - "claude-haiku-4-5-20241022"
      - "gemini-flash"
      - "gemini-flash-lite"
      - "gemini-2.0-flash"
      - "gemini-3-flash"
      - "gemini-2.5-flash"
      - "gpt-4o-mini"
      - "gpt-low"
      - "gpt-5.1-codex-mini"
      - "gpt-4.1-mini"
    # Skip if CoT patterns detected
    skip_patterns:
      - "step by step"
      - "think through"
      - "let's think"
      - "chain of thought"

# Fallback Behavior
fallback:
  when_gemini_unavailable: "Use Claude Sonnet for analysis"
  when_codex_unavailable: "Use Claude Bash tool for execution"
  retry_attempts: 2
  timeout_seconds: 30
