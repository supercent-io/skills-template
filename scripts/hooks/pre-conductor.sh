#!/usr/bin/env bash
# hooks/pre-conductor.sh â€” conductor ì‹œì‘ ì „ ì‹¤í–‰ë˜ëŠ” í›… ì˜ˆì‹œ
# ì‹¤íŒ¨ ì‹œ(exit 1) conductor íŒŒì´í”„ë¼ì¸ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.
#
# ì¸ì:
#   $1 = feature name
#   $2 = base branch
#
# ì´ íŒŒì¼ì„ ìˆ˜ì •í•´ í”„ë¡œì íŠ¸ ì „ìš© ì‚¬ì „ ì ê²€ì„ ì¶”ê°€í•˜ì„¸ìš”.

set -euo pipefail

FEATURE="${1:-}"
BASE_BRANCH="${2:-main}"

echo "ğŸª [pre-conductor] feature=$FEATURE base=$BASE_BRANCH"

# â”€â”€â”€ ì˜ˆì‹œ: ë¯¸ì»¤ë°‹ ë³€ê²½ì‚¬í•­ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [[ -n "$(git status --porcelain)" ]]; then
  echo "âš ï¸  ë¯¸ì»¤ë°‹ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤."
  echo "   conductor ì‹¤í–‰ ì „ commit ë˜ëŠ” stash í•˜ì„¸ìš”."
  # ê²½ê³ ë§Œ (ì¤‘ë‹¨í•˜ì§€ ì•ŠìŒ):
  # exit 0
  # ì¤‘ë‹¨í•˜ë ¤ë©´:
  # exit 1
fi

# â”€â”€â”€ ì˜ˆì‹œ: í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# if command -v npm &>/dev/null && [[ -f "package.json" ]]; then
#   echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
#   npm test --silent || { echo "âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. conductor ì¤‘ë‹¨."; exit 1; }
# fi

# â”€â”€â”€ ì˜ˆì‹œ: CI ìƒíƒœ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# if command -v gh &>/dev/null; then
#   STATUS=$(gh run list --branch "$BASE_BRANCH" --limit 1 --json conclusion -q '.[0].conclusion')
#   if [[ "$STATUS" != "success" ]]; then
#     echo "âš ï¸  ë§ˆì§€ë§‰ CI ìƒíƒœ: $STATUS"
#   fi
# fi

echo "âœ… [pre-conductor] ì‚¬ì „ ì ê²€ í†µê³¼"
exit 0
